<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Notes</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: 'Fira Code', monospace;
      height: 100vh;
      display: none;
      flex-direction: column;
    }

    #notepad-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100%;
    }

    header {
      background-color: #111;
      padding: 1rem;
      font-size: 1rem;
      border-bottom: 1px solid #333;
    }

    .notepad {
      flex: 1;
      padding: 1.5rem;
      font-size: 0.95rem;
      line-height: 1.5;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div id="notepad-container">
    <header>
      ssh revardo@bastion-1.acad.opswerks.net | pw: Acad_student-revardo
    </header>

    <div class="notepad">


<h2>Prometheus Assessment</h2>
<h3>Before you begin...</h3>

â€¢ Ensure with your instructor that your instance has been reset
â€¢ Make sure you can login to your instance using your account and password (see here for reference: https://academy-lab.opswerks.net/a1t-inf-lnx1/lab/environment)

<h2>Welcome, Site Reliability Engineer!</h2>

<h2>Prometheus Practical Lab Exam</h2>

<h3>ðŸ’¡ Scenario</h3>
You are a newly hired SRE at TechPro Consulting, a leading technology consultancy firm. Your team has recently landed a significant contract with GlobalCorp, a "Fortune 500 company," to enhance their infrastructure monitoring capabilities.

GlobalCorp operates a large-scale Kubernetes cluster for their mission-critical applications. Your task is to create a comprehensive monitoring system that will provide real-time insights into the health and performance of their Kubernetes environment.


<h3>ðŸ’ª The Challenge</h3>
Direct access to their Kubernetes production cluster is not permitted for external consultants due to GlobalCorp's stringent security policies. However, they have granted you access to their Prometheus instance, which is already set up to scrape metrics from their Kubernetes cluster.

Your mission is to leverage your PromQL expertise to craft queries that will form the foundation of the Grafana dashboard. These queries must extract meaningful insights from the available Kubernetes metrics without direct cluster access.


<h3>ðŸ”§ Your Tasks</h3>
You will be presented with a series of tasks that simulate the requirements for different panels in the Grafana dashboard in this lab exam. Each task will require you to write a PromQL query that retrieves specific Kubernetes metrics or calculates particular indicators of cluster health and performance.

Your ability to construct efficient and accurate PromQL queries will be crucial in delivering a robust monitoring solution for GlobalCorp. This exam will test your skills in your understanding of PromQL's capabilities and your ability to think creatively within the constraints of using Prometheus as your sole data source.

Info: Remember, the queries you craft today will directly impact GlobalCorp's ability to monitor and maintain their critical infrastructure. Good luck, and may your queries be ever insightful!


<h2>âš  Lab Rules</h2>

<h3>Query Creation</h3>
â€¢ Craft PromQL queries based on given tasks.
â€¢ Use the Expression Browser on the Prometheus website to help you create and test queries.
â€¢ Utilize only the provided metric name(s).


<h3>Query Format</h3>
â€¢ Validate queries using the Expression Browser.
â€¢ Use correct spacing.
â€¢ Use lowercase for metrics and functions consistently.
â€¢ You are NOT allowed to include the character | (pipe) in any of your queries.


<h2>Answer Submission</h2>
â€¢ Save each task answer in a file in your HOME directory:
    â€¢ Path: /home/&lt;YOURNAME&gt;/promql/
    â€¢ Filename: t<Task_Number> (e.g., t6 for Task 6)
    â€¢ Do not add file extensions.
â€¢ You can use:
    $ echo 'PROMQL_QUERY' > &lt;FILENAME&gt;
    $ echo 'rate(http_requests_total[5m])' > t1


<h2>Key Reminders</h2>
â€¢ Verify file location, naming convention, and query syntax before submission.
â€¢ Mind the quotation marks.
â€¢ Each file should contain:
    â€¢ One PromQL query for the specific task.
    â€¢ Exactly one line per file only.
â€¢ Some tasks may have empty/null result.
â€¢ Optional: View query results in either Table or Graph format.
â€¢ You will not create any Grafana dashboard.
â€¢ You can use the checkbox next to each task number to track your progress, but you must still follow the lab rules for submissions.




<h3>Access
Prometheus Site:
Open the Prometheus site: prometheus.pave.opswerks.net
Note: a window will pop up.</h3>

<h3>Tasks
Number of tasks: 25
Total points: 150</h3>

<h3>Task 1</h3>
Get all the namespace using metric kube_namespace_created and group by function.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t1
count by (namespace) (kube_namespace_created)

<h3>Task 2</h3>
Get the count of DEPLOYMENTS in the prometheus namespace using kube_deployment_created metric.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t2
count(kube_deployment_created{namespace="prometheus"})

<h3>Task 3</h3>
Get the count of PODS in the prometheus namespace using the kube_pod_info metric.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t3
count(kube_pod_created{namespace="prometheus"})

<h3>Task 4</h3>
List the pods in the prometheus namespace using kube_pod_info metric.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t4
kube_pod_created{namespace="prometheus"}

<h3>Task 5</h3>
Get the count of Kubernetes nodes using the metric kube_node_info.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t5
count(kube_node_created)

<h3>Task 6</h3>
Get the count of deployments in the ingress-nginx namespace using the metric kube_deployment_created.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t6
count(kube_deployment_created{namespace="ingress-nginx"})

<h3>Task 7</h3>
Get the count of pods in the ingress-nginx namespace using kube_pod_info metric.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t7
count(kube_pod_created{namespace="ingress-nginx"})

<h3>Task 8</h3>
Get the list of pods in the ingress-nginx namespace using the metric kube_pod_info.
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t8
kube_pod_created{namespace="ingress-nginx"}

<h3>Task 9</h3>
Get the memory resource limit of Pods in the node kind-worker using metric kube_pod_container_resource_limits
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t9
kube_pod_container_resource_limits_memory_bytes{node="kind-worker"}

<h3>Task 10</h3>
Sort memory requests in descending order using kube_pod_container_resource_requests metric
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t10
sort_desc(kube_pod_container_resource_requests_memory_bytes)

<h3>Task 11</h3>
Sort cpu requests in descending order using kube_pod_container_resource_requests metric
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t11
sort_desc(kube_pod_container_resource_requests_cpu_cores)

<h3>Task 12</h3>
Sort memory requests in ascending order using kube_pod_container_resource_requests metric
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t12
sort(kube_pod_container_resource_requests_memory_bytes)

<h3>Task 13</h3>
Sort cpu requests in ascending order using kube_pod_container_resource_requests metric
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t13
sort(kube_pod_container_resource_requests_cpu_cores)

<h3>Task 14</h3>
Return ALL pods starting with ingress- from ALL namespaces using metric name kube_pod_info
Level: Medium
Points: 10
Answer filename: /home/&lt;YOURNAME&gt;/promql/t14
kube_pod_created{pod=~"ingress-.*"}

<h3>Task 15</h3>
Return ALL pods starting with ingress- in the prometheus namespace using metric name kube_pod_info
Level: Medium
Points: 10
Answer filename: /home/&lt;YOURNAME&gt;/promql/t15
kube_pod_created{namespace="prometheus", pod=~"ingress-.*"}

<h3>Task 16</h3>
Get ALL Pods either in Running OR Pending state using metric kube_pod_status_phase
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t16
kube_pod_status_phase{phase="Running"} or kube_pod_status_phase{phase="Pending"}

<h3>Task 17</h3>
Get ALL Pods in Running phase UNLESS it is in Failed phase using metric kube_pod_status_phase
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t17
kube_pod_status_phase{phase="Running"} unless kube_pod_status_phase{phase="Failed"}

<h3>Task 18</h3>
Get ALL container with memory usage more than 536870912 (512MiB) using metric container_memory_usage_bytes
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t18
container_memory_usage_bytes > 536870912

<h3>Task 19</h3>
Convert container_memory_usage_bytes in bytes to kibibyte, 1KiB = 1024bytes
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t19
container_memory_usage_bytes / 1024

<h3>Task 20</h3>
Get the Instant rate of container_cpu_user_seconds_total of the ingress-nginx namespace over the last 5 minutes
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t20
rate(container_cpu_user_seconds_total{namespace="ingress-nginx"}[5m])

<h3>Task 21</h3>
Get the absolute value of resource type memory of kube_pod_container_resource_limits less (minus) memory of kube_pod_container_resource_requests
Level: Medium
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t21
kube_pod_container_resource_limits_memory_bytes - kube_pod_container_resource_requests_memory_bytes

<h3>Task 22</h3>
Retrieve the container_cpu_usage_seconds_total of namespace prometheus offset for 1 hour
Level: Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t22
rate(container_cpu_usage_seconds_total[5m]) - rate(container_cpu_usage_seconds_total[5m] offset 1h)

<h3>Task 23</h3>
Return the current time
Level: Super Easy
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t23
time()

<h3>Task 24</h3>
Execute the up command
Level: Giveaway
Points: 5
Answer filename: /home/&lt;YOURNAME&gt;/promql/t24
up

<h3>Task 25</h3>
Get the 99th percentile of prometheus_http_request_duration_seconds_bucket over the last 5 minutes by le Tip: You must sum the rate
Level: Hard
Points: 15
Answer filename: /home/&lt;YOURNAME&gt;/promql/t25
histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
<h2>Tip</h2>
<h2>Double check your work before logging out.</h2>

I'm done! (click here when done)
"Congratulations on completing the PromQL practical exam! Your work today demonstrates the crucial skills needed in your role as an SRE at TechPro Consulting. The queries you've crafted will form the foundation of GlobalCorp's new Kubernetes monitoring dashboard, providing them with invaluable insights into their infrastructure.

Remember, while you didn't have direct access to GlobalCorp's Kubernetes cluster, your PromQL expertise has allowed you to extract meaningful data and create a powerful monitoring solution. This showcases the importance of leveraging tools like Prometheus effectively in real-world scenarios with security constraints.

Your ability to think creatively and construct efficient queries under these conditions is exactly what makes a great SRE. The work you've done today will have a direct impact on GlobalCorp's ability to maintain and optimize their critical infrastructure.

Thank you for your hard work and ingenuity."
        
    </div>
  </div>

  <script>
    const correctPassword = "caramelo";

    function promptPassword() {
      const userInput = prompt("Enter password:");
      if (userInput === null) {
        // User clicked cancel
        document.body.innerHTML = "<p style='color:white; text-align:center; padding-top:20%; font-family: monospace;'>Access cancelled.</p>";
      } else if (userInput === correctPassword) {
        document.body.style.display = "flex";
      } else {
        alert("Incorrect password. Try again.");
        promptPassword();
      }
    }

    window.onload = promptPassword;
  </script>
</body>
</html>
